@{
    ViewData["Title"] = "Revenue Report";
}

<h2 class="mb-4">Revenue Report</h2>

<div class="mb-3">
    <button id="printButton" class="btn btn-success">
        Print Revenue Report
    </button>
</div>

<div class="card p-4 shadow-sm">

    <h4 class="mt-3">Filter Revenue</h4>

    <form id="filterForm" class="row g-3 mb-4">
        <div class="col-md-4">
            <label class="form-label">Select Month</label>
            <select name="month" class="form-select">
                <option value="">All Months</option>

                @for (int m = 1; m <= 12; m++)
                {
                    if (ViewBag.SelectedMonth == m)
                    {
                        <option value="@m" selected>
                            @(System.Globalization.CultureInfo.CurrentCulture
                            .DateTimeFormat.GetMonthName(m))
                        </option>
                    }
                    else
                    {
                        <option value="@m">
                            @(System.Globalization.CultureInfo.CurrentCulture
                            .DateTimeFormat.GetMonthName(m))
                        </option>
                    }
                }
            </select>

        </div>

        <div class="col-md-4">
            <label class="form-label">Select Year</label>
            <select name="year" class="form-select">
                <option value="">All Years</option>

                @foreach (int yr in ViewBag.Years ?? new List<int>())
                {
                    if (ViewBag.SelectedYear == yr)
                    {
                        <option value="@yr" selected>@yr</option>
                    }
                    else
                    {
                        <option value="@yr">@yr</option>
                    }
                }
            </select>

        </div>

        <div class="col-md-4 align-self-end">
            <button type="submit" class="btn btn-primary w-100">
                Filter
            </button>
        </div>
    </form>

    <div id="reportContent">
        @await Html.PartialAsync("RevenuePartial")
    </div>

</div>

@section Scripts {
<script>
    $(function () {

        $('#filterForm').on('submit', function (e) {
            e.preventDefault();

            const month = $('select[name="month"]').val();
            const year = $('select[name="year"]').val();

            $.get('@Url.Action("RevenuePartial", "Revenue")',
                { month, year },
                function (data) {
                    $('#reportContent').html(data);
                })
            .fail(function () {
                alert('Error loading revenue data.');
            });
        });

        $('#printButton').on('click', function () {
            const month = $('select[name="month"]').val();
            const year = $('select[name="year"]').val();

            const url =
                '@Url.Action("RevenuePdf", "Revenue")'
                + '?month=' + (month || '')
                + '&year=' + (year || '');

            window.open(url, '_blank');
        });

    });
</script>
}
