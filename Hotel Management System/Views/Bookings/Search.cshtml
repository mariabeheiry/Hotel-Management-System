@model List<Hotel_Management_System.Models.Room>

@{
    ViewData["Title"] = "Search Available Rooms";
}

<style>
    body {
        background: linear-gradient(135deg, #eef2f3 0%, #dfe9f3 100%);
    }

    h2 {
        font-weight: 800;
        color: #2c3e50;
        margin-bottom: 25px;
        text-align: center;
    }

    /* Form styling */
    form.mb-3 .form-control {
        border-radius: 12px;
        border: 1px solid #ced4da;
        padding: 10px;
    }

    form.mb-3 button {
        border-radius: 12px;
        padding: 10px 18px;
        font-weight: 600;
        background: linear-gradient(135deg, #0061ff, #4bcffa);
        border: none;
        color: white;
        transition: background 0.25s ease;
    }

        form.mb-3 button:hover {
            background: linear-gradient(135deg, #0050d4, #3bc0e6);
        }

    /* Alert messages */
    .alert {
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        font-size: 0.95rem;
    }

    /* Room cards */
    .card {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 12px 28px rgba(0,0,0,0.12);
        transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 18px 30px rgba(0,0,0,0.16);
        }

    .card-body h5 {
        font-weight: 700;
        color: #2c3e50;
    }

    .card-body p {
        margin-bottom: 8px;
        color: #555;
    }

    .btn-success {
        border-radius: 12px;
        font-weight: 600;
        background: linear-gradient(135deg, #28a745, #5ed38f);
        border: none;
        transition: background 0.25s ease;
    }

        .btn-success:hover {
            background: linear-gradient(135deg, #218838, #4dc47e);
        }

    /* Confirm Booking button */
    .btn-lg {
        border-radius: 12px;
        padding: 12px 24px;
        font-weight: 700;
        background: linear-gradient(135deg, #0061ff, #4bcffa);
        border: none;
        color: white;
    }

        .btn-lg:hover {
            background: linear-gradient(135deg, #0050d4, #3bc0e6);
        }

</style>

<h2>Search Available Rooms</h2>

<form method="get" asp-action="Search" class="mb-3">
    <div class="row g-2">
        <div class="col-md-3">
            <label>Check-In</label>
            <input type="date" name="checkIn" class="form-control" value="@ViewBag.CheckIn?.ToString("yyyy-MM-dd")" required />
        </div>
        <div class="col-md-3">
            <label>Check-Out</label>
            <input type="date" name="checkOut" class="form-control" value="@ViewBag.CheckOut?.ToString("yyyy-MM-dd")" required />
        </div>
        <div class="col-md-3 align-self-end">
            <button type="submit" class="btn btn-primary w-100">Search</button>
        </div>
    </div>
</form>

@if (TempData["SearchError"] != null)
{
    <div class="alert alert-danger">@TempData["SearchError"]</div>
}

@if (TempData["CartMessage"] != null)
{
    <div id="cartMessage" class="alert alert-success">
        @TempData["CartMessage"]
    </div>

    <script>
        setTimeout(function() {
            var messageDiv = document.getElementById("cartMessage");
            if (messageDiv) { messageDiv.style.display = "none"; }
        }, 3500);
    </script>
}

@if (ViewBag.CheckIn == null || ViewBag.CheckOut == null)
{
    <div class="alert alert-info text-center">
        Enter check-in and check-out dates and press <strong>Search</strong> to view available rooms.
    </div>
}
else
{
    if (!Model.Any())
    {
        <p class="text-center mt-3">No rooms available for the selected dates.</p>
    }
    else
    {
        <div class="row">
            @{
                var roomTypeImages = new Dictionary<string, string>
        {
        { "Single", "https://images.pexels.com/photos/271619/pexels-photo-271619.jpeg" },
        { "Double", "https://images.pexels.com/photos/5998055/pexels-photo-5998055.jpeg" },
        { "Suite",  "https://images.pexels.com/photos/18801079/pexels-photo-18801079.jpeg" }
        };

                var defaultImage = "https://via.placeholder.com/400x250?text=Room";
            }

            @foreach (var room in Model)
            {
                <div class="col-md-4 mb-3">
                    <div class="card h-100">

                        <img src="@(roomTypeImages.ContainsKey(room.RoomType)
                                                     ? roomTypeImages[room.RoomType]
                                                     : defaultImage)"
                             class="card-img-top"
                             alt="Room Image"
                             style="height:220px; object-fit:cover;" />

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Room @room.RoomNumber</h5>
                            <p class="mb-1">Type: @room.RoomType</p>
                            <p class="mb-1">Price: @room.Price.ToString("F2") USD/night</p>

                            <form method="post" asp-action="AddRoomToBooking" class="mt-auto">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="roomId" value="@room.RoomID" />
                                <input type="hidden" name="checkIn" value="@ViewBag.CheckIn.ToString("yyyy-MM-dd")" />
                                <input type="hidden" name="checkOut" value="@ViewBag.CheckOut.ToString("yyyy-MM-dd")" />
                                <button class="btn btn-success w-100">Book This Room</button>
                            </form>
                        </div>
                    </div>
                </div>
            }



        </div>

        <div class="mt-4 text-end">
            <form method="post" asp-action="ConfirmBookingPage" asp-controller="Bookings">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-lg">Confirm Booking</button>
            </form>
        </div>
    }
}
